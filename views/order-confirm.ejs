<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>สั่งซื้อสินค้า</title>


    <!-- add icon link -->
    <link rel="icon" href="images/LogoMakr-18GTI0.png" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>

<body onload="checkListItem()">
    <div class="container bg-light">
        <div>
            <h1 style="background-color: rgb(83, 142, 219);">การสั่งซื้อ</h1>
        </div>
        <br>
        <!-- addressOrder=(firstname, lastname, phoneNumber, address, city, province, zipcode)-->
        <div>
            <h4>ที่อยู่ในการจัดส่ง:</h4>
            <div>
                <%= dataAddress[0] %>
                    <%= dataAddress[1] %>
            </div>
            <div>ที่อยู่ <%= dataAddress[3] %> อำเภอ <%= dataAddress[4] %> จังหวัด <%= dataAddress[5] %>
                            <%= dataAddress[6] %>
            </div>
            <div>เบอร์โทรศัพท์: <%= dataAddress[2] %></div>
            <div>
                <form action="/edit-address" method="post">
                    <button type="submit" class="btn btn-primary my-2">แก้ไขที่อยู่</button>
                </form>
            </div>
        </div>
        <hr>
        <div class="table-responsive-sm">
            <table class="table" style="width: 100%">
                <thead class="table-primary">
                    <tr>
                        <th scope="col"> สินค้า</th>
                        <th scope="col" style="width: 100px;">ราคาต่อหน่วย</th>
                        <th scope="col" style="width: 77px;">จำนวน</th>
                        <th scope="col" style="width: 100px">ราคารวม</th>
                    </tr>
                </thead>
                <tbody>
                    <% let list=data; let idData='' ; let idPrice='' ; let idPriceTotal='' ; let idProductRemain='' ; if
                        (list !=undefined) { let item=list.length; } %>
                        <% for ( i in list ) { idData='data' + i; idPrice='price' + i; idPriceTotal='priceTotal' + i;
                            idProductRemain='productRemain' + i; %>
                            <tr>
                                <td scope="row">
                                    <div>
                                        <img src="product-images/<%= list[i][5] %>" alt="Images"
                                            style="height: 77px; width: 77px; margin-left: 5px; text-align: center; margin-right: 25px;">
                                        <%= list[i][1] %>
                                            <%= list[i][2] %>
                                    </div>
                                </td>
                                <td>
                                    <div id="<%= idPrice %>">
                                        <%= list[i][3] %>
                                    </div> บาท
                                </td>
                                <td>
                                    <span id="<%= idData %>">
                                        <%= list[i][4] %>

                                    </span>

                                </td>
                                <td id="<%= idPriceTotal %>">-</td>

                                <input type="hidden" id="qtyList" value="<%= list.length %>">
                                <input type="hidden" id="<%= idProductRemain %>" value="<%= list[i][6] %>">

                                <% } %>

                </tbody>
                <tfoot class="table-primary">
                    <tr>
                        <td scope="row"></td>
                        <td colspan="2">ราคารวมทั้งหมด</td>
                        <td colspan="2" id="grandTotal">-</td>

                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="d-flex justify-content-between">

            <form action="/" method="post">

                <button type="submit" class="btn btn-primary">กลับหน้าหลัก</button>

            </form>

            <form action="" method="post" id="formOrder">

                <input type="hidden" id="grandPriceOrder" name="grandPriceOrder">
                <button type="submit" class="btn btn-primary px-3" onclick="confirmOrder()">ยืนยันสั่งสินค้า</button>

            </form>
        </div>

    </div>

    <script>
        // ตรวจสอบจำนวนรายการที่สั่งซื้อ

        function checkListItem() {

            let qtyList = document.getElementById('qtyList')
            let qtyInt = parseInt(qtyList.value)

            if (qtyInt > 0) {
                sumPrice(qtyInt)

            }

        }

        // รวมราคาที่สั่งของแต่ละรายการ

        function sumPrice(qtyInt) {
            let sumPrice = 0
            let priceTotal = ''
            let sumTotal = 0
            let grandTotal = document.getElementById('grandTotal')
            let grandPriceOrder = document.getElementById('grandPriceOrder')

            for (let i = 0; i < qtyInt; i++) {

                priceTotal = document.getElementById('priceTotal' + i)
                sumPrice = parseInt(document.getElementById('price' + i).innerHTML) * parseInt(document.getElementById('data' + i).innerHTML) //นำราคาต่อหน่วยคูณกับจำนวนชิ้น
                priceTotal.innerHTML = sumPrice.toString().toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' บาท'
                sumTotal = sumTotal + sumPrice
            }
            grandPriceOrder.value = sumTotal.toString()
            grandTotal.innerHTML = sumTotal.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',') + ' บาท'

        }

    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
        crossorigin="anonymous"></script>

</body>

</html>